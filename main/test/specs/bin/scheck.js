// Generated by CoffeeScript 1.10.0

/*
 * server-checker : test/specs/bin/scheck
 * Author: MrKMG (https://github.com/mrkmg)
 *
 * MIT License
 */

(function() {
  var assert, chai, scheck, sinon;

  chai = require('chai');

  chai.use(require('chai-as-promised'));

  sinon = require('sinon');

  assert = chai.assert;

  scheck = require('../../../bin/scheck');

  describe('BIN: scheck', function() {
    before(function() {
      return sinon.spy(console, 'log');
    });
    beforeEach(function() {
      return console.log.reset();
    });
    after(function() {
      return console.log.restore();
    });
    it('should process one argument correctly', function() {
      var args, promise;
      args = ['path/to/node', 'path/to/scheck', '127.0.0.1'];
      promise = scheck(args).then(function() {
        return console.log.getCall(0).args[0];
      });
      return assert.eventually.equal(promise, 'Checking 127.0.0.1 via ping.');
    });
    it('should process two arguments correctly', function() {
      var args, promise;
      args = ['path/to/node', 'path/to/scheck', 'http', '127.0.0.1'];
      promise = scheck(args).then(function() {
        return console.log.getCall(0).args[0];
      });
      return assert.eventually.equal(promise, 'Checking 127.0.0.1 via http.');
    });
    it('should error on no arguments', function() {
      var args, promise;
      args = ['path/to/node', 'path/to/scheck'];
      promise = scheck(args).then(function() {
        return console.log.getCall(0).args[0];
      });
      return assert.eventually.equal(promise, 'Error: Missing host');
    });
    it('should error on too many arguments', function() {
      var args, promise;
      args = ['path/to/node', 'path/to/scheck', 'ping', 'host1', 'host2'];
      promise = scheck(args).then(function() {
        return console.log.getCall(0).args[0];
      });
      return assert.eventually.equal(promise, 'Error: Too many parameters!!');
    });
    it('should error on unknown type', function() {
      var args, promise;
      args = ['path/to/node', 'path/to/scheck', 'invalid', '127.0.0.1'];
      promise = scheck(args).then(function() {
        return console.log.getCall(0).args[0];
      });
      return assert.eventually.equal(promise, 'Error: invalid is not a valid method');
    });
    return it('should error after proper amount of time', function() {
      var args, promise;
      args = ['path/to/node', 'path/to/scheck', 'ping', '169.254.0.0', '--timeout', '1000'];
      promise = scheck(args).then(function() {
        return parseInt(console.log.getCall(1).args[0].match(/Took ([\d]+)/)[1]);
      });
      return assert.eventually.closeTo(promise, 1000, 100);
    });
  });

}).call(this);
